current: all


# the ANN-EXTERNAL-makefile
# everything is GnuGPL that should come with the ann.tgz
# NO WARRANTIES FOR ANYTHING
# et cetera
# (l) forum::für::umläute 2001

# make sure that the "m_pd.h" is somehow available either by putting it into this
# directory, by adding it's path to the INCLUDE-path or by putting it into an
# already included path, e.g. "/usr/local/include/"

#these are the user adjustables : adjust them to fit into your system
# PD will install to $(DESTDIR)$(INSTALLL_PREFIX)$(PDLIBDIR), which is /usr/local/lib/pd
# by default
DESTDIR =
INSTALL_PREFIX = /usr/local
PDLIBDIR = /lib/pd
#these were the user adjustables


TARGETS = ann \
	ann_som \


# ----------------------- LINUX ----------------------------
.SUFFIXES: .pd_linux


LINUXOBJECTS = $(TARGETS:%=%.o)
ARCH = $(shell uname --machine)

PD_DIR = $(DESTDIR)$(INSTALL_PREFIX)$(PDLIBDIR)

ifeq (${ARCH},alpha)
AFLAGS = -mieee  -mcpu=ev56
endif

LINCLUDE =

$(LINUXOBJECTS): *.h

#CFLAGS = -O2 -g -Wall $(LINCLUDE) $(UCFLAGS) $(AFLAGS)
CFLAGS = -O2 -O6 -funroll-loops -mpentiumpro -fomit-frame-pointer -Wall $(LINCLUDE) $(UCFLAGS) $(AFLAGS) 

everything: clean all install distclean

distclean:
	touch dummy.o
	touch dummy.pd_linux
	touch dummy~
	rm *.o *.pd_linux *~

clean:
	touch dummy.o
	touch dummy.pd_linux
	rm *.o *.pd_linux

all: $(LINUXOBJECTS)

	@echo :: $(LINUXOBJECTS)

	ld -export_dynamic  -shared -o ann.pd_linux *.o -lc -lm
	strip --strip-unneeded ann.pd_linux

.c.pd_linux:
	cc $(CFLAGS) -O2 -DPD -fPIC $(INCLUDE) -c -o $*.o $*.c


install: installdocs
	install -m 644 ann.pd_linux $(PD_DIR)/externs

installdocs:
	install -d $(PD_DIR)/doc/5.reference/ann
	install -m644 ../examples/* $(PD_DIR)/doc/5.reference/ann
