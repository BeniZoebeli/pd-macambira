# PSO - Particle Swarm Optimizer - Copyright Ben Bogart 2003
# makefile adapted from pool - Copyright (c) 2002 Thomas Grill (xovo@gmx.net)
#
# Makefile for gcc @ darwin (OSX)
#
# usage:
# to build run "make -f makefile.pd-darwin"
# to install (as root), do "make -f makefile.pd-darwin install"
#

# your c++ compiler (define only if it's different than g++)
# CXX=g++

# where are the PD header files?
# leave it blank if it is a system directory (like /usr/local/include), 
# 	since gcc 3.2 complains about it
#PDPATH=/usr/local/src/pd/src
PDPATH=/Users/davidemorelli/Desktop/robaDavide/Pd-0.38-3.app/Contents/Resources/src/

# where is the PD executable?
#PD=/usr/local/bin/pd
PD=/Users/davidemorelli/Desktop/robaDavide/Pd-0.38-3.app/Contents/Resources/bin/pd

# where do the flext libraries reside?
#FLEXTPATH=/usr/local/lib/pd/flext
#FLEXTPATH=../../grill/flext

# where is fann lib?
FANNLIB=/usr/local/lib/libfann.a

# where should flext libraries be built? 
TARGDIR=./pd-darwin

# where should pool be installed?
# (leave blank to omit installation)
#INSTPATH=/usr/local/lib/pd/extra
INSTPATH=

# additional compiler flags
# (check if they match your system!)
UFLAGS=-malign-power -maltivec

#FLEXTLIB=$(FLEXTPATH)/flext.a
#FLEXTLIB=$(FLEXTPATH)/pd-darwin/libflext.a

# compiler+linker stuff	
INCLUDES=$(PDPATH)
LIBPATH=$(FANNLIB)
FLAGS=-DFLEXT_SYS=2 
CFLAGS=-O6 ${UFLAGS} -Wno-unused -Wno-parentheses -Wno-switch -Wstrict-prototypes
LIBS=m
LDFLAGS=-bundle -bundle_loader $(PD)
FRAMEWORKS=Carbon


# ---------------------------------------------
# the rest can stay untouched
# ----------------------------------------------

NAME=ann

# all the source files from the package
SRCS=ann.c ann_mlp.c ann_td.c ann_som.c
HDRS=

DIR=.

TARGET=$(TARGDIR)/$(NAME).pd_darwin

# default target
all: $(TARGDIR) $(TARGET)

$(patsubst %,$(DIR)/%,$(SRCS)): $(patsubst %,$(DIR)/%,$(HDRS)) $(CONFIG)
	touch $@

$(TARGDIR):
	-mkdir $(TARGDIR)

$(TARGDIR)/%.o : $(DIR)/%.c
	$(CXX) -c $(CFLAGS) $(FLAGS) $(patsubst %,-I%,$(INCLUDES)) $< -o $@
#	$(CXX) -c $(CFLAGS) $(FLAGS) $< -o $@

#$(TARGET) : $(patsubst %.c,$(TARGDIR)/%.o,$(SRCS)) $(FANNLIB) 
$(TARGET) : $(patsubst %.c,$(TARGDIR)/%.o,$(SRCS))
	$(CXX) $(LDFLAGS) -I$(INCLUDES) $^ $(FANNLIB)  $(patsubst %,-framework %,$(FRAMEWORKS)) $(patsubst %,-L%,$(LIBPATH)) $(patsubst %,-l%,$(LIBS)) -o $@ 
	chmod 755 $@

$(INSTPATH):
	-mkdir $(INSTPATH)

install:: $(INSTPATH)

install:: $(TARGET)
	cp $^ $(INSTPATH)
#	chown root.root  $(patsubst %,$(INSTPATH)/%,$(notdir $^))
#	chmod 755 $(patsubst %,$(INSTPATH)/%,$(notdir $^))

.PHONY: clean
clean:
	rm -f $(TARGDIR)/*.o $(TARGET)










