
EXT=o
LIBS = -lm -lc
LIBOSC = ../libOSC/@LIBOSC@

CFLAGS = @CFLAGS@
INCLUDES = @INCLUDES@
LDFLAGS = @LDFLAGS@

prefix=$(DESTDIR)/usr

SOURCES = OSC-pattern-match.c  OSC.c  dumpOSC.c htmsocket.c  OSCroute.c  sendOSC.c
TARGETS = $(SOURCES:.c=.o)
EXTS=sendOSC.@pd_suffix@ dumpOSC.@pd_suffix@ OSCroute.@pd_suffix@ OSC.@pd_suffix@

# ----------------------- autoconf -----------------------

all: $(EXTS)

sendOSC.@pd_suffix@: sendOSC.o htmsocket.o
	cc $(LDFLAGS) -o sendOSC.@pd_suffix@ $? -lc -lm $(LIBOSC)

dumpOSC.@pd_suffix@: dumpOSC.o
	cc $(LDFLAGS) -o dumpOSC.@pd_suffix@ $? -lc -lm

OSCroute.@pd_suffix@: OSCroute.o OSC-pattern-match.o
	cc $(LDFLAGS) -o OSCroute.@pd_suffix@ $? -lc -lm

OSC.@pd_suffix@: OSC.o sendOSC.o dumpOSC.o OSCroute.o htmsocket.o OSC-pattern-match.o
	cc $(LDFLAGS) -o OSC.@pd_suffix@ $? -lc -lm $(LIBOSC)

$(TARGETS): %.o : %.c
	cc $(CFLAGS) $(INCLUDES) -c -o $*.o $*.c

# ----------------------------------------------------------

install-doc:
	@test -d $(prefix)/lib/pd/doc/5.reference || mkdir -p $(prefix)/lib/pd/doc/5.reference
	cp -r ../doc/* $(prefix)/lib/pd/doc/5.reference/

install: install-doc
	@test -d $(prefix)/lib/pd/extra || mkdir -p $(prefix)/lib/pd/extra
	install -m644 *.pd_linux $(prefix)/lib/pd/extra

clean:
	rm -rf *.$(EXT) *.@pd_suffix@
