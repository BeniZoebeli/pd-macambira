#!/bin/sh

# the source dir where this script is
SCRIPT_DIR=`echo $0 | sed 's|\(.*\)/.*$|\1|'`
. $SCRIPT_DIR/auto-build-common

# the name of this script
SCRIPT=`echo $0| sed 's|.*/\(.*\)|\1|g'`

run_build_script ()
{
	 distro=$1

	 LOGFILE=/home/pd/logs/${DATE}_${TIME}_${SYSTEM}_${HOSTNAME}_${distro}_${SCRIPT}.txt
	 touch ${LOGFILE} 

	 sh /home/pd/auto-build/${distro}/scripts/auto-build/${distro}-auto-builder.sh >> $LOGFILE 2>&1

	 rsync -a ${LOGFILE} rsync://128.238.56.50/upload/${DATE}/logs/

# send status report if something failed
	 completion_test=`tail -1 ${LOGFILE}`
	 if [ "x${completion_test}" != "xSUCCESS" ]; then
		  SUBJECT="autobuild: $distro $HOSTNAME $DATE $TIME"
		  tail -200 ${LOGFILE} | mail -s "${SUBJECT}" ${RECIPIENT}
	 fi
}

run_build_script pd-main
run_build_script pd-extended
#run_build_script pd-devel


